var generarVentaScript_=function(){var k,g,l;k=[];l=g=0;this.publico={};this.publico.addProducto=function(f){simpleScript.validaCheckBox({element:f,id:"#"+diccionario.tabs.VGEVE+"gridProductosFound",msn:lang.mensajes.MSG_9,fnCallback:function(){var e=$("#"+diccionario.tabs.VGEVE+"gridProductosFound").find("tbody").find("tr"),c,b,d,f,g,k,l,a="",m=0,h=0;$.each(e,function(e,n){c=$(this).find("td:eq(1)").find("input:checkbox");c.is(":checked")&&(b=c.val().split("~"),d=b[0],f=b[1],g=parseFloat(b[2]).toFixed(2), k=b[3],l=b[4],m=g,generarVentaScript.setIndex(),h=generarVentaScript.getIndex(),a+='<tr id="'+diccionario.tabs.VGEVE+"tr_"+h+'">',a+="    <td>",a+='        <input type="hidden" id="'+diccionario.tabs.VGEVE+h+'hhddIdProducto" name="'+diccionario.tabs.VGEVE+'hhddIdProducto[]" value="'+d+'">',a+='         <label class="textarea">',a=201600000001==simpleAjax.stringGet(d)?a+('<textarea class="editable" style="height:120px; resize: vertical;" autocomplete="on" id="'+diccionario.tabs.VGEVE+h+'txt_descripcion" name="'+ diccionario.tabs.VGEVE+'txt_descripcion[]" ></textarea>'):a+('<textarea style="background:#EFEFEF;" autocomplete="on" disabled id="'+diccionario.tabs.VGEVE+h+'txt_descripcion" name="'+diccionario.tabs.VGEVE+'txt_descripcion[]" >'+f+"</textarea>"),a+="</label>",a+="    </td>",a+="    <td>"+k+"</td>",a+="    <td>",a+='        <label class="input"><input type="text" id="'+diccionario.tabs.VGEVE+h+'txt_cantidad1" name="'+diccionario.tabs.VGEVE+'txt_cantidad1[]" value="1" style="text-align:right" data-index="'+ h+'"></label></td>',"0"==l?(a+="<td>",a+='    <label class="input"><input style="background:#EFEFEF;text-align:right;" type="text" id="'+diccionario.tabs.VGEVE+h+'txt_cantidad2" name="'+diccionario.tabs.VGEVE+'txt_cantidad2[]" value="1" style="text-align:right" data-index="'+h+'" readonly></label>'):(a+="<td>",a+='    <label class="input"><input type="text" id="'+diccionario.tabs.VGEVE+h+'txt_cantidad2" name="'+diccionario.tabs.VGEVE+'txt_cantidad2[]" value="1" style="text-align:right" data-index="'+ h+'"></label>'),a+="</td>",a+='<td class="right">1.00</td>',a+='    <td class="right">',a+='        <label class="input"><input type="text" id="'+diccionario.tabs.VGEVE+h+'txt_precio" name="'+diccionario.tabs.VGEVE+'txt_precio[]" value="'+g+'" data-value="'+g+'" data-index="'+h+'" style="text-align:right"></label>',a+="    </td>",a+='    <td class="right">'+parseFloat(m).toFixed(2)+"</td>",a+="    <td>",a+='        <button type="button" class="btn btn-danger btn-xs" onclick="generarVentaScript.removeItem(\''+ h+'\');"><i class="fa fa-trash-o"></i></a>',a+="    </td>",a+="</tr>")});""!==a&&($("#"+diccionario.tabs.VGEVE+"gridProductos").find("tbody").append(a),simpleScript.closeModal("#"+diccionario.tabs.VGEVE+"formBuscarProductos"),generarVentaScript.calculoTotal(),generarVentaScript.calculoTotalFilaUp(),$(".editable").summernote({height:120,focus:!0,lang:"es-ES",toolbar:[["font",["bold","italic","underline","clear","codeview"]]]}))}});simpleScript.removeAttr.click({container:"#"+diccionario.tabs.VGEVE+ "gridProductos",typeElement:"button"})};this.publico.removeItem=function(f){for(var e in k)k[e]===f&&(k[e]=null);$("#"+diccionario.tabs.VGEVE+"tr_"+f).remove();generarVentaScript.calculoTotal()};this.publico.getIndex=function(){return l};this.publico.setIndex=function(){l+=1;k.push(l)};this.publico.calculoTotal=function(){var f=$("#"+diccionario.tabs.VGEVE+"gridProductos").find("tbody").find("tr"),e=0;$.each(f,function(){var c=simpleScript.deleteComa($.trim($(this).find("td:eq(6)").text()));0<c.length&& (e+=parseFloat(c))});g=e;$("#"+diccionario.tabs.VGEVE+"txt_total").val(g.toFixed(2));f=1+parseFloat($("#"+diccionario.tabs.VGEVE+"txt_porcentaje").val());$("#"+diccionario.tabs.VGEVE+"txt_venta").val(parseFloat(g/f).toFixed(2));$("#"+diccionario.tabs.VGEVE+"txt_impuesto").val(parseFloat(g-g/f).toFixed(2));$("#"+diccionario.tabs.VGEVE+"txt_totalPago").val(parseFloat(g).toFixed(2));$("#"+diccionario.tabs.VGEVE+"txt_totalF").val(parseFloat(g).toFixed(2));$("#"+diccionario.tabs.VGEVE+"txt_pago").val(0)}; this.publico.calculoTotalFilaUp=function(){var f=$("#"+diccionario.tabs.VGEVE+"gridProductos").find("tbody").find("tr");$.each(f,function(){var e=$(this);$(this).find("td:eq(2)").find("input:text").keyup(function(){(isNaN($(this).val())||0>$(this).val()||""==$(this).val())&&$(this).val(1);var c=$(this).attr("data-index"),b=$(this).val(),d=simpleScript.deleteComa($("#"+diccionario.tabs.VGEVE+c+"txt_cantidad2").val()),c=simpleScript.deleteComa($("#"+diccionario.tabs.VGEVE+c+"txt_precio").val()),b=b.replace(",", ""),d=d.replace(",",""),b=parseFloat(b)*parseFloat(d);e.find("td:eq(4)").html(b.toFixed(2));d=0;d=parseFloat(c)*parseFloat(b);e.find("td:eq(6)").html(d.toFixed(2));generarVentaScript.calculoTotal()});$(this).find("td:eq(3)").find("input:text").keyup(function(){if(isNaN($(this).val())||0>$(this).val()||""==$(this).val()){var c=$(this).attr("data-value");$(this).val(c)}var c=$(this).attr("data-index"),b=$(this).val(),d=simpleScript.deleteComa($("#"+diccionario.tabs.VGEVE+c+"txt_cantidad1").val()),c= simpleScript.deleteComa($("#"+diccionario.tabs.VGEVE+c+"txt_precio").val()),b=b.replace(",",""),d=d.replace(",",""),b=parseFloat(b)*parseFloat(d),d=0,d=parseFloat(c)*parseFloat(b);e.find("td:eq(4)").html(b.toFixed(2));e.find("td:eq(6)").html(d.toFixed(2));generarVentaScript.calculoTotal()});$(this).find("td:eq(5)").find("input:text").keyup(function(){if(isNaN($(this).val())||0>=$(this).val()||""==$(this).val()){var c=$(this).attr("data-value");$(this).val(c)}var b=$(this).attr("data-index"),c=$(this).val(), d=simpleScript.deleteComa($("#"+diccionario.tabs.VGEVE+b+"txt_cantidad1").val()),b=simpleScript.deleteComa($("#"+diccionario.tabs.VGEVE+b+"txt_cantidad2").val()),d=parseFloat(d)*parseFloat(b),c=c.replace(",",""),b=0,b=parseFloat(c)*parseFloat(d);e.find("td:eq(6)").html(b.toFixed(2));generarVentaScript.calculoTotal()})})};this.publico.resetArrayProducto=function(){k=[];l=g=0};this.publico.calcularImpuesto=function(){var f=simpleScript.deleteComa($("#"+diccionario.tabs.VGEVE+"txt_venta").val()),e=simpleScript.deleteComa($("#"+ diccionario.tabs.VGEVE+"txt_totalPago").val());$("#"+diccionario.tabs.VGEVE+"chk_impuesto").is(":checked")?(f=globalScript.number_format(f,2,".",","),$("#"+diccionario.tabs.VGEVE+"txt_totalF").val(f)):(e=globalScript.number_format(e,2,".",","),$("#"+diccionario.tabs.VGEVE+"txt_totalF").val(e))};this.publico.inclIGV=function(){var f=$("#"+diccionario.tabs.VGEVE+"lst_igv").val(),e=parseFloat($("#"+diccionario.tabs.VGEVE+"txt_total").val()),c=0,b=0,d=0,b=parseFloat($("#"+diccionario.tabs.VGEVE+"txt_porcentaje").val()); "S"==f?(c=e/(1+b),b=e-c,d=e,$("#"+diccionario.tabs.VGEVE+"chk_impuesto").prop("checked",""),$("#"+diccionario.tabs.VGEVE+"chk_impuesto").attr("disabled","disabled")):(c=e,b*=e,d=e+b,$("#"+diccionario.tabs.VGEVE+"chk_impuesto").removeAttr("disabled"));c=globalScript.number_format(c,2,".",",");b=globalScript.number_format(b,2,".",",");d=globalScript.number_format(d,2,".",",");$("#"+diccionario.tabs.VGEVE+"txt_venta").val(c);$("#"+diccionario.tabs.VGEVE+"txt_impuesto").val(b);$("#"+diccionario.tabs.VGEVE+ "txt_totalPago").val(d);$("#"+diccionario.tabs.VGEVE+"txt_totalF").val(d)};return this.publico},generarVentaScript=new generarVentaScript_;